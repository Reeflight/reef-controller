{"version":3,"file":"reef-controller.js","sources":["../src/controllers/firebase-controller.js","../src/controllers/tasks-controller.js","../src/controllers/channel-controller.js","../src/controllers/reef-controller.js","../src/index.js"],"sourcesContent":["'use strict';\nimport * as firebase from \"firebase\";\nexport default class FirebaseController {\n  constructor() {\n    // Initialize Firebase\n    const config = {\n      apiKey: \"AIzaSyCxBWJTjZ822a_0bxGbTJV3F1dZoQVFo1w\",\n      authDomain: \"reeflight-fb71e.firebaseapp.com\",\n      databaseURL: \"https://reeflight-fb71e.firebaseio.com\"\n    };\n    firebase.initializeApp(config);\n    global.firebase = firebase;\n  }\n\n}\n","'use strict';\nimport logger from 'backed-logger'; //.log .error .warn\nimport {fork} from 'child_process';\nimport path from 'path';\n\nlet running = false;\nlet worker;\n\nclass Tasks {\n  constructor () {\n    this.tasks = [];\n  }\n  \n  add(task) {\n    this.runWorker(task);\n  }\n  \n  runWorker(task) {\n    if (running) {\n      worker.send({type: 'kill'});\n    }\n    worker = fork(path.join(__dirname, 'workers/profile-worker.js'));\n    worker.on('message', ({type, data}) => {\n      if (type === 'done') {\n        \n      }\n    });\n    \n    worker.send({type: 'start', data: task});\n    running = true;\n  }\n  \n}\n\nexport default new Tasks();\n\n","'use strict';\nimport FirebaseController from './firebase-controller.js';\n//import I2cController from './i2c-controller.js';\nimport tasksController from './tasks-controller.js';\n//const I2c = new I2cController();\n\nexport default class ChannelController extends FirebaseController {\n  constructor(channels=3) {\n    super();\n    async function gen(_this) {\n      try {\n        const udid = 'uid01';\n        const url = `users/Plr4JUix6xPxWmai0PlDRL34qJ32`;\n        const ref = url => {\n          return firebase.database().ref(url);\n        };\n        ref(`${url}/devices/${udid}`).on('value', snapshot => {\n          let {lanes, profileId} = snapshot.val();\n          ref(`${url}/profiles/${profileId}`).on('value', snapshot => {\n            let profile = snapshot.val();\n            tasksController.add({profile: profile, uid: '01'});\n          });\n        });\n      }\n      catch (error) {\n        throw console.error(error);\n      }\n    }\n    gen(this);\n  }\n  \n  \n  getFireData(url) {\n    return new Promise((resolve, reject) => {\n      firebase.database().ref(url).on('value', snapshot => {\n        const data = snapshot.val();\n        resolve(data);\n      });\n    });\n  }\n}\n\n","'use strict';\nimport ChannelController from './channel-controller.js'\nexport default class extends ChannelController {\n  constructor() {\n    super();\n  }\n}\n","'use strict';\nimport ReefController from './controllers/reef-controller';\n\nnew ReefController();\n"],"names":["FirebaseController","config","firebase","running","worker","Tasks","tasks","task","runWorker","send","type","fork","path","join","__dirname","on","data","ChannelController","channels","gen","_this","udid","url","ref","database","snapshot","lanes","profileId","val","profile","add","uid","error","console","Promise","resolve","reject","ReefController"],"mappings":";;;;;;;;;AAEe,MAAMA,kBAAN,CAAyB;gBACxB;UAENC,SAAS;cACL,yCADK;kBAED,iCAFC;mBAGA;KAHf;4BAKA,CAAuBA,MAAvB;WACOC,QAAP,GAAkBA,UAAlB;;;;ACNJ,IAAIC,UAAU,KAAd;AACA,IAAIC,MAAJ;AAEA,MAAMC,KAAN,CAAY;gBACK;SACRC,KAAL,GAAa,EAAb;;MAGEC,IAAJ,EAAU;SACHC,SAAL,CAAeD,IAAf;;YAGQA,IAAV,EAAgB;QACVJ,OAAJ,EAAa;aACJM,IAAP,CAAY,EAACC,MAAM,MAAP,EAAZ;;aAEOC,mBAAKC,KAAKC,IAAL,CAAUC,SAAV,EAAqB,2BAArB,CAAL,CAAT;WACOC,EAAP,CAAU,SAAV,EAAqB,CAAC,EAACL,IAAD,EAAOM,IAAP,EAAD,KAAkB;UACjCN,SAAS,MAAb,EAAqB;KADvB;WAMOD,IAAP,CAAY,EAACC,MAAM,OAAP,EAAgBM,MAAMT,IAAtB,EAAZ;cACU,IAAV;;;AAKJ,sBAAe,IAAIF,KAAJ,EAAf;;AC5Be,MAAMY,iBAAN,SAAgCjB,kBAAhC,CAAmD;cACpDkB,WAAS,CAArB,EAAwB;;mBAEPC,GAAf,CAAmBC,KAAnB,EAA0B;UACpB;cACIC,OAAO,OAAb;cACMC,MAAO,oCAAb;cACMC,MAAMD,OAAO;iBACVpB,SAASsB,QAAT,GAAoBD,GAApB,CAAwBD,GAAxB,CAAP;SADF;YAGK,GAAEA,GAAI,YAAWD,IAAK,EAA3B,EAA8BN,EAA9B,CAAiC,OAAjC,EAA0CU,YAAY;cAChD,EAACC,KAAD,EAAQC,SAAR,KAAqBF,SAASG,GAAT,EAAzB;cACK,GAAEN,GAAI,aAAYK,SAAU,EAAjC,EAAoCZ,EAApC,CAAuC,OAAvC,EAAgDU,YAAY;gBACtDI,UAAUJ,SAASG,GAAT,EAAd;4BACgBE,GAAhB,CAAoB,EAACD,SAASA,OAAV,EAAmBE,KAAK,IAAxB,EAApB;WAFF;SAFF;OANF,CAcA,OAAOC,KAAP,EAAc;cACNC,QAAQD,KAAR,CAAcA,KAAd,CAAN;;;QAGA,IAAJ;;cAIUV,GAAZ,EAAiB;WACR,IAAIY,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;eAC7BZ,QAAT,GAAoBD,GAApB,CAAwBD,GAAxB,EAA6BP,EAA7B,CAAgC,OAAhC,EAAyCU,YAAY;cAC7CT,OAAOS,SAASG,GAAT,EAAb;gBACQZ,IAAR;OAFF;KADK,CAAP;;;;AC/BJ,qBAAe,cAAcC,iBAAd,CAAgC;gBAC/B;;;;;ACAhB,IAAIoB,cAAJ"}